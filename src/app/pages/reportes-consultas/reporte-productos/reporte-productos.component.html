<div class="reporte-productos-container">
  <div class="section-header">
    <h2>Reporte de Productos</h2>
  </div>
  <div class="actions-container">
    <div class="filter-container">
      <label for="filtroTiempo">Período:</label>
      <select id="filtroTiempo" class="form-control" (change)="cambiarFiltroTiempo($event)">
        <option value="siempre" [selected]="filtroTiempo==='siempre'">Siempre</option>
        <option value="mensual" [selected]="filtroTiempo==='mensual'">Mensual</option>
        <option value="semanal" [selected]="filtroTiempo==='semanal'">Semanal</option>
        <option value="diario" [selected]="filtroTiempo==='diario'">Diario</option>
      </select>
    </div>
    <div class="filter-container">
      <label for="filtroTipo">Tipo de Reporte:</label>
      <select id="filtroTipo" class="form-control" (change)="cambiarTipoReporte($event)">
        <option value="GENERAL" [selected]="filtroTipoReporte==='GENERAL'">General</option>
        <option value="POR_PRODUCTO" [selected]="filtroTipoReporte==='POR_PRODUCTO'">Por Producto</option>
        <option value="POR_CLIENTE" [selected]="filtroTipoReporte==='POR_CLIENTE'">Por Cliente</option>
      </select>
    </div>
    <button class="btn btn-primary" (click)="exportarReporte()">Exportar</button>
  </div>
  <div class="card" *ngIf="!loading">
    <div class="table-responsive">
      <table id="tablaProductos" class="table">
        <thead>
        <tr>
          <!-- Columnas para Tipo = General -->
          <ng-container *ngIf="filtroTipoReporte==='GENERAL'">
            <th>Categoría</th>
            <th>Unidades Vendidas Totales</th>
          </ng-container>

          <!-- Columnas para Tipo = Por Producto -->
          <ng-container *ngIf="filtroTipoReporte==='POR_PRODUCTO'">
            <th>Producto</th>
            <th>Categoría</th>
            <th>Stock</th>
            <th>Precio</th>
            <th>Cantidad Vendida</th>
          </ng-container>

          <!-- Columnas para Tipo = Por Cliente -->
          <ng-container *ngIf="filtroTipoReporte==='POR_CLIENTE'">
            <th>Cliente</th>
            <th>Total Unidades</th>
            <th>Productos Comprados</th>
          </ng-container>
        </tr>
        </thead>
        <tbody>
        <!-- Filas para Tipo = General -->
        <ng-container *ngIf="filtroTipoReporte==='GENERAL'">
          <tr *ngFor="let d of detalles">
            <td>{{ d.categoria }}</td>
            <td>{{ d.unidadesVendidasTotales }}</td>
          </tr>
        </ng-container>

        <!-- Filas para Tipo = Por Producto -->
        <ng-container *ngIf="filtroTipoReporte==='POR_PRODUCTO'">
          <tr *ngFor="let d of detalles">
            <td>{{ d.nombreProducto }}</td>
            <td>{{ d.categoria }}</td>
            <td>{{ d.stock }}</td>
            <td>{{ d.precioUnitario | currency }}</td>
            <td>{{ d.cantidadVendida }}</td>
          </tr>
        </ng-container>

        <!-- Filas para Tipo = Por Cliente -->
        <ng-container *ngIf="filtroTipoReporte==='POR_CLIENTE'">
          <tr *ngFor="let d of detalles">
            <td>{{ d.nombreCliente }}</td>
            <td>{{ d.totalUnidades }}</td>
            <td>
              <ul class="product-list">
                <li *ngFor="let p of d.productosComprados">
                  {{ p.nombre }} ({{ p.cantidad }})
                </li>
              </ul>
            </td>
          </tr>
        </ng-container>
        </tbody>
      </table>
    </div>
    <div class="chart-container" style="height: 500px;">
      <canvas #productosCanvas></canvas>
    </div>
  </div>
  <div class="loading" *ngIf="loading">Cargando datos del reporte...</div>
  <div class="error" *ngIf="error">{{ error }}</div>
</div>
